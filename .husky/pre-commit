#!/bin/sh

##############################
########## FRONTEND ##########
##############################

FRONTEND_DIR="client"
cd "$FRONTEND_DIR" || exit 1

# Linting
echo "üîç Frontend - Linting"
npx lint-staged
FRONTEND_LINT_RESULT=$?

cd ..

#############################
########## BACKEND ##########
#############################

BACKEND_DIR="server"
cd "$BACKEND_DIR" || exit 1

# Building
dotnet build --nologo

# Linting
echo "üîç Backend - Linting"
dotnet format
dotnet format --verify-no-changes --verbosity quiet
BACKEND_RESULT=$?

# Testing
echo "üß™ Backend - Testing"
dotnet test
BACKEND_TEST_RESULT=$?

cd ..

# CHECKS
if [ $FRONTEND_LINT_RESULT -ne 0 ] || [ $BACKEND_RESULT -ne 0 ] || [ $BACKEND_TEST_RESULT -ne 0 ]; then
    echo "‚ùå Pre-commit checks failed. Fix the issues before committing."
    exit 1
fi

echo "‚úÖ All pre-commit checks passed!"